// This is an example file for handling web service routes.
// When implementing the real server, make sure to create an instance of `http.Server`, 
// provide a valid configuration and apply a base context

package server

import (
	"{{ .repoBaseUrl }}/{{ .serviceName }}/internal/repository/config"
	"{{ .repoBaseUrl }}/{{ .serviceName }}/internal/repository/logging"
	"{{ .repoBaseUrl }}/{{ .serviceName }}/internal/restapi/middleware"
	v1health "{{ .repoBaseUrl }}/{{ .serviceName }}/internal/restapi/v1/health" 
	
	"github.com/go-chi/chi/v5"
	"net/http"
)

func Create() chi.Router {
	logging.NoCtx().Info("Building routers...")
	server := chi.NewRouter()

	server.Use(middleware.RequestIdMiddleware())
	server.Use(middleware.LogRequestIdMiddleware())
	server.Use(middleware.CorsHeadersMiddleware())

	v1health.Create(server)
	// add your controllers here
	return server
}

func Serve(server chi.Router) {
	address := config.ServerAddr()
	logging.NoCtx().Info("Listening on " + address)
	err := http.ListenAndServe(address, server)
	if err != nil {
		logging.NoCtx().Error(err)
	}
}
